<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>n8n Automation Sidekick</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="workflow-builder-popup.css">
</head>
<body>
    <div class="app-container">
        <!-- Header -->
        <header class="header">
            <div class="logo">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M12 2L2 7V12C2 16.5 4.23 20.68 7.62 23.15L12 24L16.38 23.15C19.77 20.68 22 16.5 22 12V7L12 2Z" fill="#FF6D5A"/>
                    <path d="M9 11L7 13L9 15M15 11L17 13L15 15M13 9L11 17" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                <h1>n8n Sidekick</h1>
            </div>
            <div class="status-indicator" id="statusIndicator">
                <span class="status-dot"></span>
                <span class="status-text">Ready</span>
            </div>
        </header>

        <!-- Tab Navigation -->
        <nav class="tab-nav">
            <button class="tab-btn active" data-tab="generate">Generate</button>
            <button class="tab-btn" data-tab="builder">Builder</button>
            <button class="tab-btn" data-tab="templates">Templates</button>
            <button class="tab-btn" data-tab="setup">Setup</button>
        </nav>

        <!-- Tab Content -->
        <main class="tab-content">
            <!-- Generate Tab -->
            <div class="tab-pane active" id="generate-tab">
                <div class="input-section">
                    <label for="workflow-description">Describe your workflow</label>
                    <textarea id="workflow-description" placeholder="E.g., When a user signs up on my website, add them to my CRM and send a welcome email..."></textarea>
                    
                    <div class="options-section">
                        <label class="checkbox-label">
                            <input type="checkbox" id="include-error-handling" checked>
                            <span class="checkmark"></span>
                            Include error handling
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" id="include-logging" checked>
                            <span class="checkmark"></span>
                            Add logging nodes
                        </label>
                    </div>
                    
                    <button class="generate-btn" id="generateBtn">
                        <span class="btn-icon">üöÄ</span>
                        Generate Workflow
                    </button>
                </div>

                <div class="result-section" id="resultSection" style="display: none;">
                    <div class="result-header">
                        <h3>Generated Workflow</h3>
                        <div class="result-actions">
                            <button class="action-btn secondary" id="copyBtn">üìã Copy</button>
                            <button class="action-btn primary" id="importBtn">üì• Import to n8n</button>
                        </div>
                    </div>
                    <div class="result-content">
                        <pre id="workflowResult"></pre>
                    </div>
                </div>

                <!-- Error Section -->
                <div class="error-section hidden" id="errorSection">
                    <div class="error-icon">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <circle cx="12" cy="12" r="10" stroke="#EF4444" stroke-width="2"/>
                            <path d="M12 8V12M12 16H12.01" stroke="#EF4444" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                    </div>
                    <div class="error-content">
                        <h4>Generation Failed</h4>
                        <p id="errorMessage">Something went wrong. Please try again.</p>
                    </div>
                </div>
            </div>

            <!-- Builder Tab -->
            <div class="tab-pane" id="builder-tab">
                <div class="builder-header">
                    <h3>Visual Workflow Builder</h3>
                    <div class="builder-actions">
                        <button class="builder-btn secondary" onclick="sidekick.clearBuilder()">Clear</button>
                        <button class="builder-btn primary" onclick="sidekick.exportBuilderWorkflow()">Export JSON</button>
                    </div>
                </div>
                
                <div class="builder-canvas" id="builderCanvas">
                    <div class="canvas-area" id="canvasArea">
                        <div class="canvas-placeholder" id="canvasPlaceholder">
                            <i class="fas fa-project-diagram"></i>
                            <p>Drag nodes here to start building</p>
                        </div>
                    </div>
                    
                    <div class="node-palette">
                        <div class="palette-title">Nodes</div>
                        <div class="palette-categories">
                            <div class="category active" data-category="triggers">Triggers</div>
                            <div class="category" data-category="actions">Actions</div>
                            <div class="category" data-category="transforms">Transforms</div>
                        </div>
                        <div class="palette-nodes" id="paletteNodes">
                            <!-- Nodes will be populated here -->
                        </div>
                    </div>
                </div>
                
                <div class="builder-properties" id="builderProperties">
                    <div class="properties-header">
                        <h4>Properties</h4>
                        <button class="properties-close" onclick="sidekick.closeProperties()">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <div class="properties-content" id="propertiesContent">
                        <div class="no-selection">
                            <i class="fas fa-mouse-pointer"></i>
                            <p>Select a node to edit</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Templates Tab -->
            <div class="tab-pane" id="templates-tab">
                <div class="templates-header">
                    <h3>Workflow Templates</h3>
                    <div class="template-search">
                        <input type="text" id="templateSearch" placeholder="Search templates...">
                    </div>
                    <div class="template-actions">
                        <button class="template-btn secondary" id="fetchOfficialBtn">üåê Fetch Official n8n Templates</button>
                        <button class="template-btn secondary" id="refreshTemplatesBtn">üîÑ Refresh</button>
                    </div>
                </div>

                <div class="template-categories">
                    <button class="category-btn active" data-category="all">All</button>
                    <button class="category-btn" data-category="business">Business</button>
                    <button class="category-btn" data-category="data">Data</button>
                    <button class="category-btn" data-category="monitoring">Monitoring</button>
                    <button class="category-btn" data-category="marketing">Marketing</button>
                </div>

                <div class="templates-list" id="templatesList">
                    <!-- Templates will be populated here -->
                </div>
            </div>

            <!-- Setup Tab -->
            <div class="tab-pane" id="setup-tab">
                <div class="setup-section">
                    <h3>AI Provider Configuration</h3>
                    <div class="form-group">
                        <label for="providerSelect">AI Provider</label>
                        <select id="providerSelect">
                            <option value="openrouter">OpenRouter (Multi-Model)</option>
                            <option value="openai">OpenAI Direct</option>
                            <option value="google">Google Gemini Direct</option>
                            <option value="ollama">Ollama (Local/Free)</option>
                            <option value="groq">Groq (Free Tier)</option>
                        </select>
                    </div>

                    <!-- OpenRouter Configuration -->
                    <div id="openrouterConfig" class="provider-config">
                        <div class="form-group">
                            <label for="openrouterApiKey">OpenRouter API Key</label>
                            <input type="password" id="openrouterApiKey" placeholder="sk-or-v1-...">
                            <button class="test-btn" onclick="sidekick.testConnection('openrouter')">Test Connection</button>
                        </div>
                        <div class="form-group">
                            <label for="modelSelect">Model</label>
                            <select id="modelSelect">
                                <option value="google/gemini-2.0-flash-exp">Gemini 2.0 Flash</option>
                                <option value="openai/gpt-4o">GPT-4o</option>
                                <option value="openai/gpt-3.5-turbo">GPT-3.5 Turbo</option>
                                <option value="anthropic/claude-3.5-sonnet">Claude 3.5 Sonnet</option>
                            </select>
                        </div>
                    </div>

                    <!-- OpenAI Configuration -->
                    <div id="openaiConfig" class="provider-config" style="display: none;">
                        <div class="form-group">
                            <label for="openaiApiKey">OpenAI API Key</label>
                            <input type="password" id="openaiApiKey" placeholder="sk-...">
                            <button class="test-btn" onclick="sidekick.testConnection('openai')">Test Connection</button>
                        </div>
                        <div class="form-group">
                            <label for="openaiModel">Model</label>
                            <select id="openaiModel">
                                <option value="gpt-4">GPT-4</option>
                                <option value="gpt-3.5-turbo">GPT-3.5 Turbo</option>
                            </select>
                        </div>
                    </div>

                    <!-- Google Configuration -->
                    <div id="googleConfig" class="provider-config" style="display: none;">
                        <div class="form-group">
                            <label for="googleApiKey">Google API Key</label>
                            <input type="password" id="googleApiKey" placeholder="AIza...">
                            <button class="test-btn" onclick="sidekick.testConnection('google')">Test Connection</button>
                        </div>
                        <div class="form-group">
                            <label for="googleModel">Model</label>
                            <select id="googleModel">
                                <option value="gemini-2.0-flash-exp">Gemini 2.0 Flash</option>
                                <option value="gemini-1.5-flash">Gemini 1.5 Flash</option>
                                <option value="gemini-1.5-pro">Gemini 1.5 Pro</option>
                            </select>
                        </div>
                    </div>

                    <!-- Ollama Configuration -->
                    <div id="ollamaConfig" class="provider-config" style="display: none;">
                        <div class="form-group">
                            <label for="ollamaUrl">Ollama Server URL</label>
                            <input type="text" id="ollamaUrl" placeholder="http://localhost:11434" value="http://localhost:11434">
                            <button class="test-btn" onclick="sidekick.testConnection('ollama')">Test Connection</button>
                        </div>
                        <div class="form-group">
                            <label for="ollamaModel">Model</label>
                            <select id="ollamaModel">
                                <option value="llama3.2">Llama 3.2</option>
                                <option value="qwen2.5">Qwen 2.5</option>
                                <option value="mistral">Mistral</option>
                                <option value="codellama">Code Llama</option>
                            </select>
                        </div>
                    </div>

                    <!-- Groq Configuration -->
                    <div id="groqConfig" class="provider-config" style="display: none;">
                        <div class="form-group">
                            <label for="groqApiKey">Groq API Key</label>
                            <input type="password" id="groqApiKey" placeholder="gsk_...">
                            <button class="test-btn" onclick="sidekick.testConnection('groq')">Test Connection</button>
                        </div>
                        <div class="form-group">
                            <label for="groqModel">Model</label>
                            <select id="groqModel">
                                <option value="llama-3.1-70b-versatile">Llama 3.1 70B</option>
                                <option value="llama-3.1-8b-instant">Llama 3.1 8B</option>
                                <option value="mixtral-8x7b-32768">Mixtral 8x7B</option>
                            </select>
                        </div>
                    </div>

                    <div class="api-status" id="apiStatus"></div>
                </div>
                    <div class="form-group">
                        <label for="temperature">Creativity (Temperature)</label>
                        <input type="range" id="temperature" min="0" max="1" step="0.1" value="0.7">
                        <span class="temperature-value">0.7</span>
                    </div>
                </div>

                <div class="setup-section">
                    <h3>About</h3>
                    <div class="about-content">
                        <p><strong>n8n Automation Sidekick v1.0.0</strong></p>
                        <p>Your intelligent workflow assistant powered by OpenRouter and Gemini 2.0 Flash.</p>
                        <div class="links">
                            <a href="https://n8n.io" target="_blank">n8n Website</a>
                            <a href="https://openrouter.ai" target="_blank">OpenRouter</a>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script src="config.js"></script>
    <script src="nodes-config.js"></script>
    <script src="templates.js"></script>
    <script src="template-fetcher.js"></script>
    <script src="node-configurator.js"></script>
    <script src="workflow-builder-popup.js"></script>
    <script src="popup.js"></script>
</body>
</html>
